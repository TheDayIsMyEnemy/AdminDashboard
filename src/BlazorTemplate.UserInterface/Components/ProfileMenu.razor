@using Microsoft.AspNetCore.Components.Authorization
@using BlazorTemplate.Domain
@using BlazorTemplate.Domain.Extensions

<MudMenu Direction="Direction.Left" OffsetX="true" Dense="true" Class="mt-1 ml-4">
    <ActivatorContent>
        <MudAvatar Class="bg-dark-pink" style="width: 34px; height: 34px;">
            @_name[0]
        </MudAvatar>
    </ActivatorContent>
    <ChildContent>
        <PersonCard Class="mt-n2" Name="@name" Role="@role" />
        <MudDivider Class="mb-2" />
        <MudListItem Text="Logout"
                     Icon="@Icons.Material.Outlined.Login"
                     Href="@Infrastructure.Constants.LogoutPath"
                     ForceLoad="true" />
    </ChildContent>
</MudMenu>

@code {
    private string _name = string.Empty;
    private string? _role = null;

    [CascadingParameter]
    public Task<AuthenticationState> AuthStateTask { get; set; } = null!;

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateTask;
        _name = authState.User.GetName()!;
        _role = authState.User.GetRole();
    }
}
